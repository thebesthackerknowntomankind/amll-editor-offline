import{r as d,c as ln,u as nr,j as s,a as rr,R as or,A as sr,P as ir,b as st,d as cr,C as ar,I as lr,S as dr,e as ur,f as fr,G as mr,L as hr,g as gr,h as pr,i as xr,k as yr,l as wr,m as br,H as Tr,n as at,v as dn,o as un,p as Q,q as fn,s as vr,t as Pt,w as Lr,x as mn,y as Cr,z as Mr,B as ze,D as se,E as Sr,F as Er,J as Se,K as Xe,M as F,N as fe,O as we,Q as ke,T as qe,U as pe,V as mt,W as lt,X as hn,Y as Ar,Z as gn,_ as Ee,$ as Ge,a0 as _r,a1 as J,a2 as en,a3 as ht,a4 as pn,a5 as xn,a6 as yn,a7 as jr,a8 as Rr,a9 as Nr,aa as Ke,ab as jt,ac as tn,ad as Ue,ae as Ir,af as dt,ag as ut,ah as wn,ai as Wr,aj as Pr,ak as Br,al as Fr,am as Fe,an as Rt,ao as nn}from"./index-BSiqX_A-.js";import{D as Dr,p as kr,M as zr}from"./distributor-DM031j-X.js";var Bt="ContextMenu",[Gr]=rr(Bt,[ln]),xe=ln(),[Vr,bn]=Gr(Bt),Tn=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,dir:o,modal:i=!0}=n,[a,l]=d.useState(!1),x=xe(e),p=nr(r),g=d.useCallback(M=>{l(M),p(M)},[p]);return s.jsx(Vr,{scope:e,open:a,onOpenChange:g,modal:i,children:s.jsx(or,{...x,dir:o,open:a,onOpenChange:g,modal:i,children:t})})};Tn.displayName=Bt;var vn="ContextMenuTrigger",Ln=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,disabled:r=!1,...o}=n,i=bn(vn,t),a=xe(t),l=d.useRef({x:0,y:0}),x=d.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...l.current})}),p=d.useRef(0),g=d.useCallback(()=>window.clearTimeout(p.current),[]),M=y=>{l.current={x:y.clientX,y:y.clientY},i.onOpenChange(!0)};return d.useEffect(()=>g,[g]),d.useEffect(()=>{r&&g()},[r,g]),s.jsxs(s.Fragment,{children:[s.jsx(sr,{...a,virtualRef:x}),s.jsx(ir.span,{"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,...o,ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:r?n.onContextMenu:st(n.onContextMenu,y=>{g(),M(y),y.preventDefault()}),onPointerDown:r?n.onPointerDown:st(n.onPointerDown,wt(y=>{g(),p.current=window.setTimeout(()=>M(y),700)})),onPointerMove:r?n.onPointerMove:st(n.onPointerMove,wt(g)),onPointerCancel:r?n.onPointerCancel:st(n.onPointerCancel,wt(g)),onPointerUp:r?n.onPointerUp:st(n.onPointerUp,wt(g))})]})});Ln.displayName=vn;var Or="ContextMenuPortal",Cn=n=>{const{__scopeContextMenu:e,...t}=n,r=xe(e);return s.jsx(cr,{...r,...t})};Cn.displayName=Or;var Mn="ContextMenuContent",Sn=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=bn(Mn,t),i=xe(t),a=d.useRef(!1);return s.jsx(ar,{...i,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:l=>{n.onCloseAutoFocus?.(l),!l.defaultPrevented&&a.current&&l.preventDefault(),a.current=!1},onInteractOutside:l=>{n.onInteractOutside?.(l),!l.defaultPrevented&&!o.modal&&(a.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Sn.displayName=Mn;var Zr="ContextMenuGroup",En=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(mr,{...o,...r,ref:e})});En.displayName=Zr;var $r="ContextMenuLabel",An=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(hr,{...o,...r,ref:e})});An.displayName=$r;var Hr="ContextMenuItem",_n=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(lr,{...o,...r,ref:e})});_n.displayName=Hr;var qr="ContextMenuCheckboxItem",jn=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(ur,{...o,...r,ref:e})});jn.displayName=qr;var Ur="ContextMenuRadioGroup",Rn=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(gr,{...o,...r,ref:e})});Rn.displayName=Ur;var Kr="ContextMenuRadioItem",Nn=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(pr,{...o,...r,ref:e})});Nn.displayName=Kr;var Xr="ContextMenuItemIndicator",In=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(fr,{...o,...r,ref:e})});In.displayName=Xr;var Yr="ContextMenuSeparator",Wn=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(dr,{...o,...r,ref:e})});Wn.displayName=Yr;var Jr="ContextMenuArrow",Qr=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(xr,{...o,...r,ref:e})});Qr.displayName=Jr;var eo="ContextMenuSubTrigger",Pn=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(yr,{...o,...r,ref:e})});Pn.displayName=eo;var to="ContextMenuSubContent",Bn=d.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=xe(t);return s.jsx(wr,{...o,...r,ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Bn.displayName=to;function wt(n){return e=>e.pointerType!=="mouse"?n(e):void 0}var no=Tn,ro=Ln,Fn=Cn,oo=Sn,so=En,io=An,co=_n,ao=jn,lo=Rn,uo=Nn,Dn=In,fo=Wn,mo=Pn,ho=Bn;const gt=n=>d.createElement(no,{...n});gt.displayName="ContextMenu.Root";const pt=d.forwardRef(({children:n,...e},t)=>d.createElement(ro,{...e,ref:t,asChild:!0},br(n)));pt.displayName="ContextMenu.Trigger";const kn=d.createContext({}),xt=d.forwardRef((n,e)=>{const t=Tr(),{size:r=at.size.default,variant:o=at.variant.default,highContrast:i=at.highContrast.default}=n,{className:a,children:l,color:x,container:p,forceMount:g,...M}=dn(n,at),y=x||t.accentColor;return d.createElement(Fn,{container:p,forceMount:g},d.createElement(un,{asChild:!0},d.createElement(oo,{"data-accent-color":y,alignOffset:-Number(r)*4,collisionPadding:10,...M,asChild:!1,ref:e,className:Q("rt-PopperContent","rt-BaseMenuContent","rt-ContextMenuContent",a)},d.createElement(fn,{type:"auto"},d.createElement("div",{className:Q("rt-BaseMenuViewport","rt-ContextMenuViewport")},d.createElement(kn.Provider,{value:d.useMemo(()=>({size:r,variant:o,color:y,highContrast:i}),[r,o,y,i])},l))))))});xt.displayName="ContextMenu.Content";const go=d.forwardRef(({className:n,...e},t)=>d.createElement(io,{...e,asChild:!1,ref:t,className:Q("rt-BaseMenuLabel","rt-ContextMenuLabel",n)}));go.displayName="ContextMenu.Label";const Me=d.forwardRef((n,e)=>{const{className:t,children:r,color:o=vr.color.default,shortcut:i,...a}=n;return d.createElement(co,{"data-accent-color":o,...a,ref:e,className:Q("rt-reset","rt-BaseMenuItem","rt-ContextMenuItem",t)},d.createElement(Pt,null,r),i&&d.createElement("div",{className:"rt-BaseMenuShortcut rt-ContextMenuShortcut"},i))});Me.displayName="ContextMenu.Item";const po=d.forwardRef(({className:n,...e},t)=>d.createElement(so,{...e,asChild:!1,ref:t,className:Q("rt-BaseMenuGroup","rt-ContextMenuGroup",n)}));po.displayName="ContextMenu.Group";const xo=d.forwardRef(({className:n,...e},t)=>d.createElement(lo,{...e,asChild:!1,ref:t,className:Q("rt-BaseMenuRadioGroup","rt-ContextMenuRadioGroup",n)}));xo.displayName="ContextMenu.RadioGroup";const yo=d.forwardRef((n,e)=>{const{children:t,className:r,color:o=Cr.color.default,...i}=n;return d.createElement(uo,{...i,asChild:!1,ref:e,"data-accent-color":o,className:Q("rt-BaseMenuItem","rt-BaseMenuRadioItem","rt-ContextMenuItem","rt-ContextMenuRadioItem",r)},d.createElement(Pt,null,t),d.createElement(Dn,{className:"rt-BaseMenuItemIndicator rt-ContextMenuItemIndicator"},d.createElement(mn,{className:"rt-BaseMenuItemIndicatorIcon rt-ContextMenuItemIndicatorIcon"})))});yo.displayName="ContextMenu.RadioItem";const Wt=d.forwardRef((n,e)=>{const{children:t,className:r,shortcut:o,color:i=Lr.color.default,...a}=n;return d.createElement(ao,{...a,asChild:!1,ref:e,"data-accent-color":i,className:Q("rt-BaseMenuItem","rt-BaseMenuCheckboxItem","rt-ContextMenuItem","rt-ContextMenuCheckboxItem",r)},d.createElement(Pt,null,t),d.createElement(Dn,{className:"rt-BaseMenuItemIndicator rt-ContextMenuItemIndicator"},d.createElement(mn,{className:"rt-BaseMenuItemIndicatorIcon rt-ContextMenuItemIndicatorIcon"})),o&&d.createElement("div",{className:"rt-BaseMenuShortcut rt-ContextMenuShortcut"},o))});Wt.displayName="ContextMenu.CheckboxItem";const wo=d.forwardRef((n,e)=>{const{className:t,children:r,...o}=n;return d.createElement(mo,{...o,asChild:!1,ref:e,className:Q("rt-BaseMenuItem","rt-BaseMenuSubTrigger","rt-ContextMenuItem","rt-ContextMenuSubTrigger",t)},r,d.createElement("div",{className:"rt-BaseMenuShortcut rt-ContextMenuShortcut"},d.createElement(Mr,{className:"rt-BaseMenuSubTriggerIcon rt-ContextMenuSubTriggerIcon"})))});wo.displayName="ContextMenu.SubTrigger";const bo=d.forwardRef((n,e)=>{const{size:t,variant:r,color:o,highContrast:i}=d.useContext(kn),{className:a,children:l,container:x,forceMount:p,...g}=dn({size:t,variant:r,color:o,highContrast:i,...n},at);return d.createElement(Fn,{container:x,forceMount:p},d.createElement(un,{asChild:!0},d.createElement(ho,{"data-accent-color":o,alignOffset:-Number(t)*4,sideOffset:1,collisionPadding:10,...g,asChild:!1,ref:e,className:Q("rt-PopperContent","rt-BaseMenuContent","rt-BaseMenuSubContent","rt-ContextMenuContent","rt-ContextMenuSubContent",a)},d.createElement(fn,{type:"auto"},d.createElement("div",{className:Q("rt-BaseMenuViewport","rt-ContextMenuViewport")},l)))))});bo.displayName="ContextMenu.SubContent";const Tt=d.forwardRef(({className:n,...e},t)=>d.createElement(fo,{...e,asChild:!1,ref:t,className:Q("rt-BaseMenuSeparator","rt-ContextMenuSeparator",n)}));Tt.displayName="ContextMenu.Separator";const To=ze("PaddingLeftRegular","1em",["M2 3.5a.5.5 0 0 1 1 0v1a.5.5 0 0 1-1 0v-1Zm0 3a.5.5 0 0 1 1 0v2a.5.5 0 0 1-1 0v-2Zm0 4a.5.5 0 0 1 1 0v2a.5.5 0 0 1-1 0v-2Zm0 4a.5.5 0 0 1 1 0v1a.5.5 0 0 1-1 0v-1Zm2.15-4.65a.5.5 0 0 1 0-.7l4.5-4.5a.5.5 0 1 1 .7.7L5.71 9h9.79a.5.5 0 0 1 0 1H5.7l3.65 3.65a.5.5 0 0 1-.7.7l-4.5-4.5ZM17 3.5a.5.5 0 0 1 1 0v12a.5.5 0 0 1-1 0v-12Z"]),vo=ze("PaddingRightRegular","1em",["M15.85 9.85a.5.5 0 0 0 0-.7l-4.5-4.5a.5.5 0 0 0-.7.7L14.29 9H4.5a.5.5 0 0 0 0 1h9.8l-3.65 3.65a.5.5 0 0 0 .7.7l4.5-4.5ZM3 3.5a.5.5 0 0 0-1 0v12a.5.5 0 0 0 1 0v-12Zm15 0a.5.5 0 0 0-1 0v1a.5.5 0 0 0 1 0v-1Zm0 3a.5.5 0 0 0-1 0v2a.5.5 0 0 0 1 0v-2Zm0 4a.5.5 0 0 0-1 0v2a.5.5 0 0 0 1 0v-2Zm0 4a.5.5 0 0 0-1 0v1a.5.5 0 0 0 1 0v-1Z"]),Lo=ze("CutRegular","1em",["M5.92 2.23a.5.5 0 0 0-.84.54L9.4 9.43l-1.92 2.96a3 3 0 1 0 .78.64L10 10.35l1.74 2.68a3 3 0 1 0 .78-.64L5.92 2.23ZM14 17a2 2 0 1 1 0-4 2 2 0 0 1 0 4ZM4 15a2 2 0 1 1 4 0 2 2 0 0 1-4 0Zm7.2-6.49-.6-.92 3.48-5.36a.5.5 0 0 1 .84.54l-3.73 5.74Z"]),Co=ze("TaskListLtrRegular","1em",["M5.85 4.35a.5.5 0 1 0-.7-.7L3.5 5.29l-.65-.64a.5.5 0 1 0-.7.7l1 1c.2.2.5.2.7 0l2-2ZM8.5 5a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9Zm0 5a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9ZM8 15.5c0-.28.22-.5.5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5ZM5.85 9.85a.5.5 0 1 0-.7-.7L3.5 10.79l-.65-.64a.5.5 0 0 0-.7.7l1 1c.2.2.5.2.7 0l2-2Zm0 4.3c.2.2.2.5 0 .7l-2 2a.5.5 0 0 1-.7 0l-1-1a.5.5 0 0 1 .7-.7l.65.64 1.65-1.64c.2-.2.5-.2.7 0Z"]),Mo=ze("VideoBackgroundEffectFilled","1em",["M6.2 4 2 8.2V6.8L4.8 4h1.4Zm7 0-1.46 1.46a3.48 3.48 0 0 0-1.02-.39L11.79 4h1.42Zm-1.08 3.17a2.51 2.51 0 0 0-2.34-1.16 2.5 2.5 0 1 0 2.34 1.16Zm.72-.72c.2.29.37.6.48.94L16.69 4 16.5 4h-1.2l-2.46 2.45ZM7.5 12c-.08 0-.15 0-.22.02A1.5 1.5 0 0 0 6 13.5V16h8v-2.5a1.5 1.5 0 0 0-1.5-1.5h-5Zm5-1c.22 0 .43.03.63.08L18 6.2V5.5c0-.2-.04-.4-.12-.59l-4.5 4.5a3.5 3.5 0 0 1-.93 1.59h.05Zm1.9.88c.23.27.4.58.5.93L18 9.7V8.29l-3.6 3.6ZM15 16v-1.2l3-3v1.4L15.2 16H15Zm-10-.3v-1.4l-1.7 1.69.2.01h1.2l.3-.3Zm1.57-6.48c.08.36.21.7.4 1.02L2.11 15.1A1.5 1.5 0 0 1 2 14.5v-.7l4.57-4.58ZM9.71 4 2 11.7v-1.4L8.3 4h1.4Z"]),So=ze("SplitVerticalRegular","1em",["M10 2.5a.5.5 0 0 0-1 0v15a.5.5 0 0 0 1 0v-15ZM4 4a2 2 0 0 0-2 2v8c0 1.1.9 2 2 2h4v-1H4a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h4V4H4Zm7 0v1h4a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-4v1h4a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-4Z"]),Eo=ze("TextAlignRightFilled","1em",["M6 4.25c0-.41.34-.75.75-.75h10.5a.75.75 0 0 1 0 1.5H6.75A.75.75 0 0 1 6 4.25Zm-4 5c0-.41.34-.75.75-.75h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 9.25Zm7.75 4.25a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5h-7.5Z"]),Ne=n=>n,Ft=n=>({_tag:"Left",value:n}),vt=n=>({_tag:"Right",value:n}),Ao=(n,e,t)=>t._tag==="Left"?n(t.value):e(t.value),zn={dimap:(n,e,t)=>r=>e(t(n(r))),first:n=>([e,t])=>[n(e),t],right:n=>e=>e._tag==="Left"?e:vt(n(e.value)),wander:n=>e=>e.map(n)},_o={empty:()=>{},foldMap:(n,e)=>{for(let t=0;t<e.length;t++){const r=n(e[t]);if(r!=null)return r}}},jo={empty:()=>[],foldMap:(n,e)=>{let t=[];return e.forEach(r=>{t=t.concat(n(r))}),t}},Dt=n=>({dimap:(e,t,r)=>o=>r(e(o)),first:e=>([t,r])=>e(t),right:e=>t=>t._tag==="Left"?n.empty():e(t.value),wander:e=>t=>n.foldMap(e,t)}),Nt={Equivalence:{Equivalence:"Equivalence",Iso:"Iso",Lens:"Lens",Prism:"Prism",Traversal:"Traversal",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Iso:{Equivalence:"Iso",Iso:"Iso",Lens:"Lens",Prism:"Prism",Traversal:"Traversal",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Lens:{Equivalence:"Lens",Iso:"Lens",Lens:"Lens",Prism:"Prism",Traversal:"Traversal",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Prism:{Equivalence:"Prism",Iso:"Prism",Lens:"Prism",Prism:"Prism",Traversal:"Traversal",Getter:"AffineFold",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Traversal:{Equivalence:"Traversal",Iso:"Traversal",Lens:"Traversal",Prism:"Traversal",Traversal:"Traversal",Getter:"Fold",AffineFold:"Fold",Fold:"Fold",Setter:"Setter"},Getter:{Equivalence:"Getter",Iso:"Getter",Lens:"Getter",Prism:"AffineFold",Traversal:"Fold",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:void 0},AffineFold:{Equivalence:"AffineFold",Iso:"AffineFold",Lens:"AffineFold",Prism:"AffineFold",Traversal:"Fold",Getter:"AffineFold",AffineFold:"AffineFold",Fold:"Fold",Setter:void 0},Fold:{Equivalence:"Fold",Iso:"Fold",Lens:"Fold",Prism:"Fold",Traversal:"Fold",Getter:"Fold",AffineFold:"Fold",Fold:"Fold",Setter:void 0},Setter:{Equivalence:void 0,Iso:void 0,Lens:void 0,Prism:void 0,Traversal:void 0,Getter:void 0,AffineFold:void 0,Fold:void 0,Setter:void 0}},Ye=(n,e)=>{const t=e;return t._tag=n,t},Gn=n=>(n._removable=!0,n);function H(n,e,t){if(arguments.length===2){const r=(o,i)=>n(o,e(o,i));return r._tag=Nt[n._tag][e._tag],r._removable=e._removable||!1,r}else{const r=Nt[n._tag][e._tag],o=(i,a)=>n(i,e(i,t(i,a)));return o._tag=Nt[r][t._tag],o._removable=t._removable||!1,o}}const Ro=Ye("Equivalence",(n,e)=>e),Lt=(n,e)=>Ye("Iso",(t,r)=>t.dimap(n,e,r)),Le=(n,e)=>Ye("Lens",(t,r)=>t.dimap(o=>[n(o),o],e,t.first(r))),kt=(n,e)=>Ye("Prism",(t,r)=>t.dimap(n,o=>Ao(Ne,e,o),t.right(r))),zt=Ye("Traversal",(n,e)=>n.dimap(Ne,Ne,n.wander(e))),No=n=>Ye("Getter",(e,t)=>e.dimap(n,Ne,t)),Vn=(n,e,t)=>n(zn,e)(t),Io=(n,e,t)=>n(zn,()=>e)(t),Wo=(n,e)=>n(Dt({}),Ne)(e),Po=(n,e)=>n(Dt(_o),Ne)(e),On=(n,e)=>n(Dt(jo),t=>[t])(e),Bo=Lt(n=>n.map((e,t)=>[t,e]),n=>{const e=[...n].sort((r,o)=>r[0]-o[0]),t=[];for(let r=0;r<e.length;++r)(r===e.length-1||e[r][0]!==e[r+1][0])&&t.push(e[r][1]);return t}),rn=n=>Le(e=>e[n],([e,t])=>Object.assign(Object.assign({},t),{[n]:e})),Fo=n=>Le(e=>{const t={};for(const r of n)t[r]=e[r];return t},([e,t])=>{const r=Object.assign({},t);for(const o of n)delete r[o];return Object.assign(r,e)}),Zn=n=>Le(e=>e[n],([e,t])=>{const r=t.slice();return r[n]=e,r}),Gt=Zn(0),Vt=n=>kt(e=>n(e)?vt(e):Ft(e),Ne),ft=Symbol("__no_match__"),$n=Vt(n=>n!==ft),Hn=Symbol("__remove_me__"),It=n=>Gn(H(Le(e=>0<=n&&n<e.length?e[n]:ft,([e,t])=>{if(e===ft)return t;if(e===Hn)return typeof t=="string"?t.substring(0,n)+t.substring(n+1):[...t.slice(0,n),...t.slice(n+1)];if(typeof t=="string")return n===0?e+t.substring(1):n===t.length?t.substring(0,n-1)+e:t.substring(0,n)+e+t.substring(n+1);{const r=t.slice();return r[n]=e,r}}),$n)),Do=kt(n=>n===void 0?Ft(void 0):vt(n),Ne),ko=n=>kt(e=>n(e)?vt(e):Ft(e),Ne),zo=n=>Gn(H(Le(e=>{const t=e.findIndex(n);return t===-1?[ft,-1]:[e[t],t]},([[e,t],r])=>{if(e===ft)return r;if(e===Hn)return[...r.slice(0,t),...r.slice(t+1)];const o=r.slice();return o[t]=e,o}),Gt,$n)),Go=n=>H(Le(e=>{const t=e.map((r,o)=>n(r)?o:null).filter(r=>r!=null);return[t.map(r=>e[r]),t]},([[e,t],r])=>{const o=r.length,i=e.length;let a=0,l=0,x=0;const p=[];for(;a<o;)t[l]===a?(++l,x<i&&(p.push(e[x]),++x)):p.push(r[a]),++a;for(;x<i;)p.push(e[x++]);return p}),Gt),Vo=n=>Le(e=>e===void 0?n:e,([e,t])=>e),Oo=n=>H(Le(e=>{const t=On(n,e);return[t,t.length]},([[e,t],r])=>{if(e.length!==t)throw new Error("cannot add/remove elements through partsOf");let o=0;return Vn(n,()=>e[o++],r)}),Gt),Zo=n=>Le(e=>n(e),([e,t])=>e),$o=n=>Le(e=>e,([e,t])=>n(e)),Ho=Le(n=>{},([n,e])=>n===void 0?e:[n,...e]),qo=Le(n=>{},([n,e])=>n===void 0?e:[...e,n]),Uo=H(Lt(n=>n.split(""),n=>n.join("")),zt),Ko=H(Lt(n=>n.split(/\b/),n=>n.join("")),zt,Vt(n=>!/\s+/.test(n)));class K{constructor(e){this._ref=e}get _tag(){return this._ref._tag}get _removable(){return this._ref._removable}compose(e){return new K(H(this._ref,e._ref))}iso(e,t){return new K(H(this._ref,Lt(e,t)))}lens(e,t){return new K(H(this._ref,Le(e,([r,o])=>t(o,r))))}indexed(){return new K(H(this._ref,Bo))}prop(e){return new K(H(this._ref,rn(e)))}path(...e){return e.length===1&&(e=e[0].split(".")),new K(e.reduce((t,r)=>H(t,rn(r)),this._ref))}pick(e){return new K(H(this._ref,Fo(e)))}nth(e){return new K(H(this._ref,Zn(e)))}filter(e){return new K(H(this._ref,Go(e)))}valueOr(e){return new K(H(this._ref,Vo(e)))}partsOf(e){const t=typeof e=="function"?e(qn):e;return new K(H(this._ref,Oo(t._ref)))}reread(e){return new K(H(this._ref,Zo(e)))}rewrite(e){return new K(H(this._ref,$o(e)))}optional(){return new K(H(this._ref,Do))}guard_(){return e=>this.guard(e)}guard(e){return new K(H(this._ref,ko(e)))}at(e){return new K(H(this._ref,It(e)))}head(){return new K(H(this._ref,It(0)))}index(e){return new K(H(this._ref,It(e)))}find(e){return new K(H(this._ref,zo(e)))}elems(){return new K(H(this._ref,zt))}to(e){return new K(H(this._ref,No(e)))}when(e){return new K(H(this._ref,Vt(e)))}chars(){return new K(H(this._ref,Uo))}words(){return new K(H(this._ref,Ko))}prependTo(){return new K(H(this._ref,Ho))}appendTo(){return new K(H(this._ref,qo))}}const qn=new K(Ro);function Xo(){return qn}function Yo(n){return e=>Wo(n._ref,e)}function Jo(n){return e=>Po(n._ref,e)}function Qo(n){return e=>On(n._ref,e)}function es(n){return e=>t=>Vn(n._ref,e,t)}function ts(n){return e=>t=>Io(n._ref,e,t)}const on=(n,e,t)=>(e.has(t)?e:e.set(t,n())).get(t),ns=new WeakMap,rs=(n,e,t)=>{const r=on(()=>new WeakMap,ns,e);return on(n,r,t)},os=n=>typeof n=="function";function ss(n,e){return rs(()=>{const t=e(Xo());return se(o=>{const i=o(n);return i instanceof Promise?i.then(a=>sn(t,a)):sn(t,i)},(o,i,a)=>{const l=os(a)?es(t)(a):ts(t)(a),x=o(n);return i(n,x instanceof Promise?x.then(l):l(x))})},n,e)}const sn=(n,e)=>n._tag==="Traversal"?Qo(n)(e):n._tag==="Prism"?Jo(n)(e):Yo(n)(e);var it={},cn;function is(){if(cn)return it;cn=1,Object.defineProperty(it,"__esModule",{value:!0}),it.ViewportList=void 0;const n=Sr(),e=Er(),t=typeof window>"u",r=!t&&(()=>{try{return"ontouchstart"in window||navigator.maxTouchPoints}catch{return!1}})(),o=!t&&(()=>{try{return window.CSS.supports("overflow-anchor: auto")}catch{return!1}})(),i=r&&!o,a={top:"top",bottom:"bottom",clientHeight:"clientHeight",scrollHeight:"scrollHeight",scrollTop:"scrollTop",overflowY:"overflowY",height:"height",minHeight:"minHeight",maxHeight:"maxHeight",marginTop:"marginTop"},l={top:"left",bottom:"right",scrollHeight:"scrollWidth",clientHeight:"clientWidth",scrollTop:"scrollLeft",overflowY:"overflowX",minHeight:"minWidth",height:"width",maxHeight:"maxWidth",marginTop:"marginLeft"},x=(f,h,v=1/0)=>Math.max(Math.min(h,v),f),p=(f,h,v)=>Math.ceil(Math.abs(f-h)/v),g=t?e.useEffect:e.useLayoutEffect,M=(f,h,v)=>{const S=[];for(let W=f;W<h;W++)S.push(v(W));return S},y=({fromElement:f,toElement:h,fromIndex:v,asc:S=!0,compare:W})=>{let N=v,E=f;for(;E&&E!==h;){if(W(E,N))return[E,N];S?(N++,E=E.nextSibling):(N--,E=E.previousSibling)}return[null,-1]},w=/auto|scroll/gi,C=(f,h)=>{if(!h||h===document.body||h===document.documentElement)return document.documentElement;const v=window.getComputedStyle(h);return w.test(v[f.overflowY])||w.test(v.overflow)?h:C(f,h.parentNode)},b=(f,h,v=0)=>({padding:0,margin:0,border:"none",visibility:"hidden",overflowAnchor:"none",[f.minHeight]:h,[f.height]:h,[f.maxHeight]:h,[f.marginTop]:v}),m=({items:f=[],count:h,children:v,viewportRef:S,itemSize:W=0,itemMargin:N=-1,overscan:E=1,axis:B="y",initialIndex:I=-1,initialAlignToTop:G=!0,initialOffset:R=0,initialDelay:j=-1,initialPrerender:_=0,onViewportIndexesChange:D,overflowAnchor:u="auto",withCache:T=!0,scrollThreshold:k=0,renderSpacer:Z=({ref:c,style:O})=>(0,n.jsx)("div",{ref:c,style:O}),indexesShift:q=0,getItemBoundingClientRect:L=c=>c.getBoundingClientRect()},V)=>{const c=B==="y"?a:l,O=typeof h=="number",z=(O?h:f.length)-1,[[$,te],ye]=(0,e.useState)(()=>[x(0,W),x(-1,N)]),le=x(0,$+te),be=x(0,Math.ceil(E*le)),[ne,Y]=(0,e.useState)([I-_,I+_]),ce=(0,e.useRef)(null),de=(0,e.useRef)(-1),Te=(0,e.useRef)(null),Ae=(0,e.useRef)(null),Je=(0,e.useRef)(!1),Kt=(0,e.useRef)(q),Qe=(0,e.useRef)([]),Ie=(0,e.useRef)(I>=0?{index:I,alignToTop:G,offset:R,delay:j,prerender:_}:null),et=(0,e.useRef)(null),je=(0,e.useRef)(0),yt=(0,e.useRef)([-1,-1]),tt=(0,e.useRef)(null),[ee,me]=(0,e.useMemo)(()=>{ne[0]=x(0,ne[0],z),ne[1]=x(ne[0],ne[1],z);const P=q-Kt.current;Kt.current=q;const U=Te.current;return U&&P&&(ne[0]=x(0,ne[0]+P,z),ne[1]=x(ne[0],ne[1]+P,z),ce.current=U.nextSibling,de.current=ne[0],Je.current=!0),ne},[q,ne,z]),Xn=(0,e.useMemo)(()=>b(c,(T?Qe.current:[]).slice(0,ee).reduce((P,U)=>P+(U-$),ee*le),je.current),[c,T,ee,le,$]),Yn=(0,e.useMemo)(()=>b(c,(T?Qe.current:[]).slice(me+1,z+1).reduce((P,U)=>P+(U-$),le*(z-me))),[c,T,me,z,le,$]),Ve=(0,e.useMemo)(()=>{let P=null;return()=>{if(S)return S.current===document.body?document.documentElement:S.current;if(P&&P.isConnected)return P;const U=Te.current;return U?(P=C(c,U.parentNode),P):null}},[c,S]),St=(0,e.useRef)(()=>{}),Xt=(0,e.useRef)(()=>({index:-1,offset:0}));g(()=>{St.current=()=>{const P=Ve(),U=Te.current,re=Ae.current;if(!P||!U||!re)return;const ie=U.nextSibling,ge=re.previousSibling,_e=P.getBoundingClientRect(),ue=U.getBoundingClientRect(),ae=re.getBoundingClientRect(),ve={[c.top]:P===document.documentElement?0:_e[c.top],[c.bottom]:P===document.documentElement?document.documentElement[c.clientHeight]:_e[c.bottom]},oe={[c.top]:ve[c.top]-be,[c.bottom]:ve[c.bottom]+be};if(je.current<0&&ue[c.top]-je.current>=oe[c.top]||je.current>0&&ue[c.top]>=oe[c.top]||je.current&&Ie.current){U.style[c.marginTop]="0px",P.style[c.overflowY]="hidden",P[c.scrollTop]+=-je.current,P.style[c.overflowY]="",je.current=0;return}if($===0||te===-1){let X=0;if(y({fromElement:ie,toElement:re,fromIndex:ee,compare:Be=>(X+=L(Be)[c.height],!1)}),!X)return;const he=me-ee+1,Re=$===0?Math.ceil(X/he):$,Pe=te===-1?Math.ceil((ae[c.top]-ue[c.bottom]-X)/he):te;ye([Re,Pe]);return}if(et.current)return;if(Ie.current){const X=x(0,Ie.current.index,z);if(X<ee||X>me){Y([X-Ie.current.prerender,X+Ie.current.prerender]);return}const[he]=y({fromElement:ie,toElement:re,fromIndex:ee,compare:(At,_t)=>_t===X});if(!he)return;const{alignToTop:Re,offset:Pe,delay:Be}=Ie.current;Ie.current=null;const Jt=()=>{const At=L(he),_t=Re?At[c.top]-ve[c.top]+Pe:At[c.bottom]-ve[c.top]-P[c.clientHeight]+Pe;P[c.scrollTop]+=_t,et.current=null},Qt=Be<0&&i?30:Be;if(Qt>0){et.current=setTimeout(Jt,Qt);return}Jt();return}if(tt.current===null)tt.current=P.scrollTop;else if(tt.current!==P.scrollTop){const X=Math.abs(P.scrollTop-tt.current);if(tt.current=P.scrollTop,k>0&&X>k)return}const nt=ie===re?re:ie.nextSibling,Yt=ge===U?U:ge.previousSibling,Oe=Math.ceil((ae[c.top]-ue[c.bottom])/(me+1-ee)),rt=ue[c.bottom]>oe[c.bottom],ot=ae[c.top]<oe[c.top],Jn=!rt&&!ot&&ue[c.bottom]>oe[c.top],Qn=!rt&&!ot&&ae[c.top]<oe[c.bottom],er=!rt&&!ot&&(Yt===U?ue:L(Yt))[c.bottom]>oe[c.bottom],tr=!rt&&!ot&&(nt===re?ae:L(nt))[c.top]<oe[c.top];let Ce=ee,We=me;if(rt&&(Ce-=p(ue[c.bottom],oe[c.top],Oe),We-=p(ae[c.top],oe[c.bottom],Oe)),ot&&(We+=p(ae[c.top],oe[c.bottom],Oe),Ce+=p(ue[c.bottom],oe[c.top],Oe)),Jn&&(Ce-=p(ue[c.bottom],oe[c.top],Oe)),Qn&&(We+=p(ae[c.top],oe[c.bottom],Oe)),er){const[,X]=y({fromElement:ge,toElement:U,fromIndex:me,asc:!1,compare:he=>L(he)[c.bottom]<=oe[c.bottom]});X!==-1&&(We=X+1)}if(tr){const[,X]=y({fromElement:ie,toElement:re,fromIndex:ee,compare:he=>L(he)[c.top]>=oe[c.top]});X!==-1&&(Ce=X-1)}if(D){let[,X]=y({fromElement:ie,toElement:re,fromIndex:ee,compare:Re=>L(Re)[c.bottom]>ve[c.top]});X===-1&&(X=ee);let[,he]=y({fromElement:ge,toElement:U,fromIndex:me,asc:!1,compare:Re=>L(Re)[c.top]<ve[c.bottom]});he===-1&&(he=me),(X!==yt.current[0]||he!==yt.current[1])&&(yt.current=[X,he],D(yt.current))}if(Ce=x(0,Ce,z),We=x(Ce,We,z),!(Ce===ee&&We===me)){if(Ce!==ee)if(ee>=Ce)ce.current=ie,de.current=ee;else{const[X,he]=y({fromElement:ie,toElement:re,fromIndex:ee,compare:(Re,Pe)=>{if(Pe===Ce)return!0;const Be=L(Re);return Be[c.height]!==$&&(Qe.current[Pe]=Be[c.height]),!1}});X?(ce.current=X,de.current=he):(ce.current=ge,de.current=me)}Y([Ce,We])}},Xt.current=()=>{const P=Ve(),U=Te.current,re=Ae.current;let ie=-1,ge=0;if(!P||!U||!re)return{index:ie,offset:ge};const _e=U.nextSibling,ue=P.getBoundingClientRect(),ae={[c.top]:P===document.documentElement?0:ue[c.top],[c.bottom]:P===document.documentElement?document.documentElement[c.clientHeight]:ue[c.bottom]};return y({fromElement:_e,toElement:re,fromIndex:ee,compare:(ve,oe)=>{const nt=L(ve);return ie=oe,ge=ae[c.top]-nt[c.top],nt[c.bottom]>ae[c.top]}}),{index:ie,offset:ge}}});let Et;return ce.current&&Ve()&&Te.current&&(Et=L(ce.current)[c.top]-(Ve()===document.documentElement?0:Ve().getBoundingClientRect()[c.top])),g(()=>{ce.current=null;const P=de.current,U=Je.current;de.current=-1,Je.current=!1;const re=Ve(),ie=Te.current,ge=Ae.current;if(P===-1||!re||!ie||!ge||Et===void 0||o&&u!=="none"&&!U)return;let _e=null;if(P>=ee&&P<=me){const[ae]=y({fromElement:ie.nextSibling,toElement:ge,fromIndex:ee,compare:(ve,oe)=>oe===P});ae&&(_e=L(ae)[c.top])}else P<ee?_e=ie.getBoundingClientRect()[c.top]+(T?Qe.current:[]).slice(0,P).reduce((ae,ve)=>ae+(ve-$),P*le):P<=z&&(_e=ge.getBoundingClientRect()[c.top]+(T?Qe.current:[]).slice(me+1,P).reduce((ae,ve)=>ae+(ve-$),le*(P-1-me)));if(_e===null)return;const ue=_e-(re===document.documentElement?0:re.getBoundingClientRect()[c.top])-Et;if(ue){if(r){je.current-=ue,ie.style[c.marginTop]=`${je.current}px`;return}re[c.scrollTop]+=ue}},[ee]),g(()=>{let P;const U=()=>{P=requestAnimationFrame(U),St.current()};return U(),()=>{cancelAnimationFrame(P),et.current&&clearTimeout(et.current)}},[]),(0,e.useImperativeHandle)(V,()=>({scrollToIndex:({index:P=-1,alignToTop:U=!0,offset:re=0,delay:ie=-1,prerender:ge=0})=>{Ie.current={index:P,alignToTop:U,offset:re,delay:ie,prerender:ge},St.current()},getScrollPosition:()=>Xt.current()}),[]),(0,n.jsxs)(e.Fragment,{children:[Z({ref:Te,style:Xn,type:"top"}),(!!h||!!f.length)&&M(ee,me+1,O?v:P=>v(f[P],P,f)),Z({ref:Ae,style:Yn,type:"bottom"})]})};return it.ViewportList=(0,e.forwardRef)(m),it}var cs=is();const as="_lyricWord_1xtlx_12",ls="_edit_1xtlx_13",ds="_sync_1xtlx_22",us="_dropLeft_1xtlx_31",fs="_dropRight_1xtlx_35",ms="_advance_1xtlx_39",hs="_wordGroup_1xtlx_49",gs="_advanceBar_1xtlx_58",ps="_displayWord_1xtlx_67",xs="_startTime_1xtlx_71",ys="_endTime_1xtlx_72",ws="_lyricLine_1xtlx_102",bs="_dropTop_1xtlx_113",Ts="_dropBottom_1xtlx_117",vs="_ignoreSync_1xtlx_121",Ls="_insertWordField_1xtlx_131",Cs="_empty_1xtlx_144",Ms="_lyricLineContainer_1xtlx_149",Ss="_lyricWordsContainer_1xtlx_161",Es="_hideTimestamps_1xtlx_185",As="_blank_1xtlx_206",_s="_error_1xtlx_210",js="_selected_1xtlx_216",Rs="_active_1xtlx_260",Ns="_lineNumber_1xtlx_268",Is="_ignored_1xtlx_293",Ws="_lyricLinesWrapper_1xtlx_302",Ps="_locateButton_1xtlx_308",A={lyricWord:as,edit:ls,sync:ds,dropLeft:us,dropRight:fs,advance:ms,wordGroup:hs,advanceBar:gs,displayWord:ps,startTime:xs,endTime:ys,lyricLine:ws,dropTop:bs,dropBottom:Ts,ignoreSync:vs,insertWordField:Ls,empty:Cs,lyricLineContainer:Ms,lyricWordsContainer:Ss,hideTimestamps:Es,blank:As,error:_s,selected:js,active:Rs,lineNumber:Ns,ignored:Is,lyricLinesWrapper:Ws,locateButton:Ps};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};const Ot=globalThis.jotaiAtomCache.get("/vercel/path0/src/modules/lyric-editor/components/lyric-line-menu.tsx/selectedLinesSizeAtom",se(n=>n(Se).size));Ot.debugLabel="selectedLinesSizeAtom";Ot.debugLabel="selectedLinesSizeAtom";const Ct=({lineIndex:n})=>{const{t:e}=Xe(),t=F(Ot),r=F(Se),o=fe(we),i=F(we),a=i.lyricLines.filter(m=>r.has(m.id)),[l,x]=d.useState(()=>a.every(m=>m.isBG)?!0:a.every(m=>!m.isBG)?!1:"indeterminate"),[p,g]=d.useState(()=>a.every(m=>m.isDuet)?!0:a.every(m=>!m.isDuet)?!1:"indeterminate"),M=(()=>{if(t<2)return null;const m=i.lyricLines.filter(v=>r.has(v.id)).map(v=>i.lyricLines.indexOf(v)),f=Math.min(...m),h=Math.max(...m);if(m.length!==h-f+1)return null;for(let v=f;v<=h;v++)if(!m.includes(v))return null;return{minIdx:f,maxIdx:h}})();function y(m){x(m),o(f=>{const h=f.lyricLines.filter(v=>r.has(v.id));for(const v of h)v.isBG=m})}function w(m){g(m),o(f=>{const h=f.lyricLines.filter(v=>r.has(v.id));for(const v of h)v.isDuet=m})}return s.jsxs(s.Fragment,{children:[s.jsx(Wt,{checked:l,onCheckedChange:y,children:e("contextMenu.bgLyric","背景歌词")}),s.jsx(Wt,{checked:p,onCheckedChange:w,children:e("contextMenu.duetLyric","对唱歌词")}),s.jsx(Tt,{}),s.jsx(Me,{onSelect:()=>{o(m=>{m.lyricLines.splice(n,0,ke())})},children:e("contextMenu.insertLineBefore","在前插入空行")}),s.jsx(Me,{onSelect:()=>{o(m=>{m.lyricLines.splice(n+1,0,ke())})},children:e("contextMenu.insertLineAfter","在后插入空行")}),s.jsx(Me,{onSelect:b,disabled:t===0,children:e("contextMenu.copyLine",{count:t,defaultValue:"复制行"})}),s.jsx(Me,{onSelect:C,disabled:!M,children:e("contextMenu.combineLine","合并行")}),s.jsx(Me,{onSelect:()=>{o(m=>{t===0?m.lyricLines.splice(n,1):m.lyricLines=m.lyricLines.filter(f=>!r.has(f.id))})},children:e("contextMenu.deleteLine",{count:t,defaultValue:"删除行"})})]});function C(){o(m=>{if(!M)return;const{minIdx:f,maxIdx:h}=M,v=m.lyricLines[f];for(let S=f+1;S<=h;S++){const W=m.lyricLines[S];v.words.push(...W.words)}v.endTime=m.lyricLines[h].endTime,m.lyricLines.splice(f+1,h-f)})}function b(){o(m=>{m.lyricLines=m.lyricLines.flatMap(f=>{if(!r.has(f.id))return f;const h={...f,id:ke().id,words:f.words.map(v=>({...v,id:qe().id}))};return[f,h]})})}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};const Ze=globalThis.jotaiAtomCache.get("/vercel/path0/src/modules/lyric-editor/components/lyric-line-view-states.ts/draggingIdAtom",se(""));Ze.debugLabel="draggingIdAtom";Ze.debugLabel="draggingIdAtom";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};function De(n){n.words.length&&(n.startTime=n.words[0].startTime||n.startTime,n.endTime=n.words[n.words.length-1].endTime||n.endTime)}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};const Zt=globalThis.jotaiAtomCache.get("/vercel/path0/src/modules/lyric-editor/components/lyric-word-menu.tsx/selectedLinesSizeAtom",se(n=>n(Se).size));Zt.debugLabel="selectedLinesSizeAtom";Zt.debugLabel="selectedLinesSizeAtom";const $t=globalThis.jotaiAtomCache.get("/vercel/path0/src/modules/lyric-editor/components/lyric-word-menu.tsx/selectedWordsSizeAtom",se(n=>n(pe).size));$t.debugLabel="selectedWordsSizeAtom";$t.debugLabel="selectedWordsSizeAtom";const Ht=({wordIndex:n,wordAtom:e,lineIndex:t})=>{const{t:r}=Xe(),o=mt(),i=F($t),a=F(Zt),l=fe(we),x=lt(hn),p=lt(Ar),g=lt(gn),M=F(e);return s.jsxs(s.Fragment,{children:[s.jsx(Me,{disabled:i!==1,onSelect:()=>{g({wordIndex:n,lineIndex:t,word:M.word}),x(!0)},children:r("contextMenu.splitWord","拆分单词…")}),s.jsx(Me,{disabled:i!==1,onSelect:()=>{g({wordIndex:n,lineIndex:t,word:M.word}),p(!0)},children:r("contextMenu.replaceWord","替换单词…")}),s.jsx(Me,{disabled:!(i>1&&a===1),onSelect:()=>{l(C=>{const b=o.get(pe),m=C.lyricLines[t];if(m){const f=m.words.filter(h=>b.has(h.id));if(f.length>1){const h=f.map(E=>E.word).join(""),v=f[0],S=f[f.length-1],W=m.words.indexOf(v),N=qe();N.word=h,N.startTime=v.startTime,N.endTime=S.endTime,C.lyricLines[t].words=m.words.filter(E=>!b.has(E.id)),W!==-1&&C.lyricLines[t].words.splice(W,0,N)}}})},children:r("contextMenu.combineWords","合并单词")}),s.jsx(Me,{disabled:i===0,onSelect:()=>{l(C=>{const b=o.get(pe);for(const m of C.lyricLines){const f=m.words.length,h=m.words.filter(v=>!b.has(v.id));m.words=h,f!==h.length&&De(m)}})},children:r("contextMenu.deleteWords",{count:i,defaultValue:"删除选定单词"})}),s.jsx(Tt,{}),s.jsx(Me,{disabled:i!==1,onSelect:()=>w(),children:r("contextMenu.moveFollowingWordToNewLine","此后单词拆至新行")}),s.jsx(Me,{disabled:i===0,onSelect:()=>y(),children:r("contextMenu.moveWordToNewLine",{count:i,defaultValue:"所选单词拆至新行"})}),s.jsx(Tt,{})]});function y(){l(C=>{const b=o.get(pe),m=[];for(const h of C.lyricLines){const v=h.words.length>0&&(b.has(h.words[0].id)||b.has(h.words[h.words.length-1].id));h.words=h.words.filter(S=>b.has(S.id)?(m.push(S),!1):!0),v&&De(h)}const f={...ke(),isBG:C.lyricLines[t].isBG,isDuet:C.lyricLines[t].isDuet};f.words.push(...m),De(f),C.lyricLines.splice(t+1,0,f)})}function w(){l(C=>{const b=C.lyricLines[t];if(!b)return;const m=b.words[n];if(!m)return;/^\s*$/.test(m.word)&&!m.startTime&&!m.endTime&&b.words.splice(n,1);const f=b.words.splice(n),h={...ke(),isBG:b.isBG,isDuet:b.isDuet};h.words.push(...f),De(b),De(h),C.lyricLines.splice(t+1,0,h)})}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};const $e=globalThis.jotaiAtomCache.get("/vercel/path0/src/modules/lyric-editor/components/lyric-word-view.tsx/isDraggingAtom",se(!1));$e.debugLabel="isDraggingAtom";$e.debugLabel="isDraggingAtom";const Mt=n=>{const e=Ee.c(2);let t;return e[0]!==n?(t=n.length===0||n.length>0&&n.trim().length===0,e[0]=n,e[1]=t):t=e[1],t},Un=n=>{const e=Ee.c(60),{wordAtom:t,wordIndex:r,line:o,lineIndex:i,className:a,children:l,onDoubleClick:x}=n,p=F(t),g=mt(),M=fe(we),y=fe(Se);let w;e[0]!==t?(w=se(L=>L(pe).has(L(t).id)),e[0]=t,e[1]=w):w=e[1];const b=F(w),m=F(pe),f=fe(pe),h=F(Ge),v=d.useRef(!1);let S;e[2]!==o||e[3]!==y||e[4]!==f||e[5]!==p||e[6]!==r?(S=function(V){V.ctrlKey||V.metaKey?f(c=>{c.has(p.id)?c.delete(p.id):c.add(p.id)}):V.shiftKey?f(c=>{if(c.size>0){let O=Number.NaN,z=Number.NaN;o.words.forEach(($,te)=>{c.has($.id)&&(Number.isNaN(O)&&(O=te),Number.isNaN(z)&&(z=te),O=Math.min(O,te,r),z=Math.max(z,te,r))});for(let $=O;$<=z;$++)c.add(o.words[$].id)}else c.add(p.id)}):(y(c=>{(!c.has(o.id)||c.size!==1)&&(c.clear(),c.add(o.id))}),f(c=>{(!c.has(p.id)||c.size!==1)&&(c.clear(),c.add(p.id))}))},e[2]=o,e[3]=y,e[4]=f,e[5]=p,e[6]=r,e[7]=S):S=e[7];const W=S;let N;e[8]!==b||e[9]!==o||e[10]!==y||e[11]!==f||e[12]!==p?(N=L=>{L&&(b||(f(V=>{V.clear(),V.add(p.id)}),y(V=>{V.clear(),V.add(o.id)})))},e[8]=b,e[9]=o,e[10]=y,e[11]=f,e[12]=p,e[13]=N):N=e[13];const E=h===J.Edit;let B,I;e[14]===Symbol.for("react.memo_cache_sentinel")?(B=L=>{v.current=L.target?.tagName==="INPUT"},I=()=>{v.current=!1},e[14]=B,e[15]=I):(B=e[14],I=e[15]);let G;e[16]!==b||e[17]!==W||e[18]!==g?(G=L=>{if(v.current){v.current=!1,L.preventDefault(),L.stopPropagation();return}b||W(L),L.dataTransfer.effectAllowed="copyMove",L.dataTransfer.dropEffect="move",g.set($e,!0),L.stopPropagation()},e[16]=b,e[17]=W,e[18]=g,e[19]=G):G=e[19];let R;e[20]!==g?(R=()=>{g.set($e,!1),v.current=!1},e[20]=g,e[21]=R):R=e[21];let j;e[22]!==b||e[23]!==g?(j=L=>{if(!g.get($e)||b)return;L.preventDefault(),L.dataTransfer.dropEffect="move";const V=L.currentTarget.getBoundingClientRect();L.clientX-V.left<V.width/2?(L.currentTarget.classList.add(A.dropLeft),L.currentTarget.classList.remove(A.dropRight)):(L.currentTarget.classList.remove(A.dropLeft),L.currentTarget.classList.add(A.dropRight));const O=L.ctrlKey||L.metaKey;L.dataTransfer.dropEffect=O?"copy":"move"},e[22]=b,e[23]=g,e[24]=j):j=e[24];let _;e[25]!==M||e[26]!==b||e[27]!==o||e[28]!==m||e[29]!==f||e[30]!==g||e[31]!==p?(_=L=>{if(L.currentTarget.classList.remove(A.dropLeft),L.currentTarget.classList.remove(A.dropRight),!g.get($e)||b)return;const V=L.currentTarget.getBoundingClientRect(),O=L.clientX-V.left>V.width/2,z=L.ctrlKey||L.metaKey;M($=>{let te=[];for(const Y of $.lyricLines){const ce=Y.words.filter(de=>m.has(de.id));if(te.push(...ce),!z){const de=Y.words.length>0&&(m.has(Y.words[0].id)||m.has(Y.words[Y.words.length-1].id));Y.words=Y.words.filter(Te=>!m.has(Te.id)),de&&De(Y)}}const ye=$.lyricLines.find(Y=>{const{id:ce}=Y;return ce===o.id});if(!ye)throw new Error("Target line not found");const le=ye.words.findIndex(Y=>Y.id===p.id);if(le<0)throw new Error("Target word not found");z&&(te=te.map(zs),f(Y=>{Y.clear();for(const ce of te)Y.add(ce.id)}));const be=le+(O?1:0),ne=be===0||be===ye.words.length;ye.words.splice(be,0,...te),ne&&De(ye)})},e[25]=M,e[26]=b,e[27]=o,e[28]=m,e[29]=f,e[30]=g,e[31]=p,e[32]=_):_=e[32];let D;e[33]!==b||e[34]!==W||e[35]!==h?(D=L=>{console.log("[LyricWord] click",{button:L.button,target:L.target?.tagName,toolMode:h,isWordSelected:b}),L.stopPropagation(),L.preventDefault(),W(L)},e[33]=b,e[34]=W,e[35]=h,e[36]=D):D=e[36];let u;e[37]!==l||e[38]!==a||e[39]!==x||e[40]!==_||e[41]!==D||e[42]!==E||e[43]!==G||e[44]!==R||e[45]!==j?(u=s.jsx(pt,{children:s.jsx("span",{draggable:E,onPointerDown:B,onPointerUp:I,onDragStart:G,onDragEnd:R,onDragOver:j,onDrop:_,onDragLeave:Gs,className:a,onDoubleClick:x,onClick:D,children:l})}),e[37]=l,e[38]=a,e[39]=x,e[40]=_,e[41]=D,e[42]=E,e[43]=G,e[44]=R,e[45]=j,e[46]=u):u=e[46];let T;e[47]!==i||e[48]!==t||e[49]!==r?(T=s.jsx(Ht,{wordAtom:t,wordIndex:r,lineIndex:i}),e[47]=i,e[48]=t,e[49]=r,e[50]=T):T=e[50];let k;e[51]!==i?(k=s.jsx(Ct,{lineIndex:i}),e[51]=i,e[52]=k):k=e[52];let Z;e[53]!==T||e[54]!==k?(Z=s.jsxs(xt,{children:[T,k]}),e[53]=T,e[54]=k,e[55]=Z):Z=e[55];let q;return e[56]!==u||e[57]!==Z||e[58]!==N?(q=s.jsxs(gt,{onOpenChange:N,children:[u,Z]}),e[56]=u,e[57]=Z,e[58]=N,e[59]=q):q=e[59],q};function bt(n){const e=Ee.c(35);let t,r,o,i,a,l;e[0]!==n?({wordAtom:l,fieldName:r,formatter:o,parser:a,children:t,...i}=n,e[0]=n,e[1]=t,e[2]=r,e[3]=o,e[4]=i,e[5]=a,e[6]=l):(t=e[1],r=e[2],o=e[3],i=e[4],a=e[5],l=e[6]);const[x,p]=d.useState(void 0),[g,M]=d.useState(""),y=fe(we);let w;e[7]!==r||e[8]!==o||e[9]!==l?(w=se(R=>{const j=R(l);return o(j[r])}),e[7]=r,e[8]=o,e[9]=l,e[10]=w):w=e[10];const b=F(w),m=mt();let f;e[11]!==b||e[12]!==y||e[13]!==r||e[14]!==a||e[15]!==m||e[16]!==l?(f=R=>{try{const j=m.get(l),_=a(R);y(D=>{for(const u of D.lyricLines)for(const T of u.words)if(j.id===T.id){T[r]=_;break}return D})}catch{typeof b=="string"&&p(b)}},e[11]=b,e[12]=y,e[13]=r,e[14]=a,e[15]=m,e[16]=l,e[17]=f):f=e[17];const h=f;let v,S;e[18]!==b?(v=()=>{p(b),M("")},S=[b],e[18]=b,e[19]=v,e[20]=S):(v=e[19],S=e[20]),d.useLayoutEffect(v,S);const W=x??"",N=x===void 0;let E;e[21]===Symbol.for("react.memo_cache_sentinel")?(E=R=>p(R.currentTarget.value),e[21]=E):E=e[21];let B;e[22]!==h?(B=R=>{R.key==="Enter"&&h(R.currentTarget.value)},e[22]=h,e[23]=B):B=e[23];let I;e[24]!==b||e[25]!==h?(I=R=>{R.currentTarget.value!==b&&h(R.currentTarget.value)},e[24]=b,e[25]=h,e[26]=I):I=e[26];let G;return e[27]!==t||e[28]!==g||e[29]!==i||e[30]!==W||e[31]!==N||e[32]!==B||e[33]!==I?(G=s.jsx(ht,{size:"1",value:W,placeholder:g,disabled:N,onChange:E,onKeyDown:B,onBlur:I,...i,children:t}),e[27]=t,e[28]=g,e[29]=i,e[30]=W,e[31]=N,e[32]=B,e[33]=I,e[34]=G):G=e[34],G}const Bs=n=>{const e=Ee.c(72),{wordAtom:t,wordIndex:r,line:o,lineIndex:i}=n,a=mt(),l=fe(we),x=lt(hn),p=lt(gn),g=F(t),M=F(Ge);let y;e[0]!==t?(y=se(de=>de(pe).has(de(t).id)),e[0]=t,e[1]=y):y=e[1];const C=F(y),b=Mt(g.word),m=g.startTime>g.endTime,f=C&&A.selected,h=b&&A.blank,v=m&&M===J.Edit&&A.error;let S;e[2]!==f||e[3]!==h||e[4]!==v?(S=Q(A.lyricWord,A.edit,A.advance,f,h,v),e[2]=f,e[3]=h,e[4]=v,e[5]=S):S=e[5];const W=S;let N;e[6]===Symbol.for("react.memo_cache_sentinel")?(N={minWidth:"0"},e[6]=N):N=e[6];let E;e[7]===Symbol.for("react.memo_cache_sentinel")?(E=s.jsx(jt,{children:s.jsx(To,{})}),e[7]=E):E=e[7];let B;e[8]!==t?(B=s.jsx(bt,{size:"1",color:"green",wordAtom:t,fieldName:"startTime",formatter:Ke,parser:tn,style:N,children:E}),e[8]=t,e[9]=B):B=e[9];let I;e[10]!==g.word||e[11]!==i||e[12]!==x||e[13]!==p||e[14]!==r?(I=()=>{p({wordIndex:r,lineIndex:i,word:g.word}),x(!0)},e[10]=g.word,e[11]=i,e[12]=x,e[13]=p,e[14]=r,e[15]=I):I=e[15];let G;e[16]===Symbol.for("react.memo_cache_sentinel")?(G=s.jsx(Lo,{}),e[16]=G):G=e[16];let R;e[17]!==I?(R=s.jsx(Ue,{variant:"soft",size:"1",onClick:I,children:G}),e[17]=I,e[18]=R):R=e[18];let j;e[19]===Symbol.for("react.memo_cache_sentinel")?(j={minWidth:"0em"},e[19]=j):j=e[19];let _;e[20]!==t?(_=s.jsx(bt,{size:"1",wordAtom:t,fieldName:"word",formatter:String,parser:String,style:j}),e[20]=t,e[21]=_):_=e[21];let D;e[22]!==l||e[23]!==a?(D=()=>{l(de=>{const Te=a.get(pe);for(const Ae of de.lyricLines)Ae.words=Ae.words.filter(Je=>!Te.has(Je.id))})},e[22]=l,e[23]=a,e[24]=D):D=e[24];let u;e[25]===Symbol.for("react.memo_cache_sentinel")?(u=s.jsx(Dr,{}),e[25]=u):u=e[25];let T;e[26]!==D?(T=s.jsx(Ue,{variant:"soft",size:"1",onClick:D,children:u}),e[26]=D,e[27]=T):T=e[27];let k;e[28]!==R||e[29]!==_||e[30]!==T?(k=s.jsxs("div",{className:A.advanceBar,children:[R,_,T]}),e[28]=R,e[29]=_,e[30]=T,e[31]=k):k=e[31];let Z;e[32]===Symbol.for("react.memo_cache_sentinel")?(Z={minWidth:"0"},e[32]=Z):Z=e[32];let q;e[33]===Symbol.for("react.memo_cache_sentinel")?(q=s.jsx(jt,{children:s.jsx(vo,{})}),e[33]=q):q=e[33];let L;e[34]!==t?(L=s.jsx(bt,{size:"1",color:"red",wordAtom:t,fieldName:"endTime",formatter:Ke,parser:tn,style:Z,children:q}),e[34]=t,e[35]=L):L=e[35];let V;e[36]===Symbol.for("react.memo_cache_sentinel")?(V={minWidth:"0"},e[36]=V):V=e[36];let c;e[37]===Symbol.for("react.memo_cache_sentinel")?(c=s.jsx(jt,{children:s.jsx(So,{})}),e[37]=c):c=e[37];let O;e[38]!==t?(O=s.jsx(bt,{size:"1",type:"number",min:0,wordAtom:t,fieldName:"emptyBeat",formatter:String,parser:Number.parseInt,style:V,children:c}),e[38]=t,e[39]=O):O=e[39];let z;e[40]!==g.emptyBeat||e[41]!==g.word||e[42]!==l?(z=()=>{l(de=>{for(const Te of de.lyricLines)for(const Ae of Te.words)Ae.word===g.word&&(Ae.emptyBeat=g.emptyBeat)})},e[40]=g.emptyBeat,e[41]=g.word,e[42]=l,e[43]=z):z=e[43];let $;e[44]===Symbol.for("react.memo_cache_sentinel")?($=s.jsx(Co,{}),e[44]=$):$=e[44];let te;e[45]!==z?(te=s.jsx(Ue,{variant:"soft",size:"1",onClick:z,children:$}),e[45]=z,e[46]=te):te=e[46];let ye;e[47]!==O||e[48]!==te?(ye=s.jsxs("div",{className:A.advanceBar,children:[O,te]}),e[47]=O,e[48]=te,e[49]=ye):ye=e[49];let le;e[50]!==W||e[51]!==o||e[52]!==i||e[53]!==k||e[54]!==L||e[55]!==ye||e[56]!==B||e[57]!==t||e[58]!==r?(le=s.jsx(pt,{children:s.jsxs(Un,{wordAtom:t,wordIndex:r,lineIndex:i,className:W,line:o,children:[B,k,L,ye]})}),e[50]=W,e[51]=o,e[52]=i,e[53]=k,e[54]=L,e[55]=ye,e[56]=B,e[57]=t,e[58]=r,e[59]=le):le=e[59];let be;e[60]!==i||e[61]!==t||e[62]!==r?(be=s.jsx(Ht,{wordAtom:t,wordIndex:r,lineIndex:i}),e[60]=i,e[61]=t,e[62]=r,e[63]=be):be=e[63];let ne;e[64]!==i?(ne=s.jsx(Ct,{lineIndex:i}),e[64]=i,e[65]=ne):ne=e[65];let Y;e[66]!==be||e[67]!==ne?(Y=s.jsxs(xt,{children:[be,ne]}),e[66]=be,e[67]=ne,e[68]=Y):Y=e[68];let ce;return e[69]!==le||e[70]!==Y?(ce=s.jsxs(gt,{children:[le,Y]}),e[69]=le,e[70]=Y,e[71]=ce):ce=e[71],ce},Fs=n=>{const e=Ee.c(25),{wordAtom:t,wordIndex:r,line:o,lineIndex:i}=n,a=F(t),l=fe(we),x=fe(Se);let p;e[0]!==t?(p=se(R=>R(pe).has(R(t).id)),e[0]=t,e[1]=p):p=e[1];const M=F(p),y=fe(pe),[w,C]=d.useState(!1),b=F(Ge),m=Mt(a.word),f=Kn(a.word,m),h=a.startTime>a.endTime,v=M&&A.selected,S=m&&A.blank,W=h&&b===J.Edit&&A.error;let N;e[2]!==v||e[3]!==S||e[4]!==W?(N=Q(A.lyricWord,A.edit,v,S,W),e[2]=v,e[3]=S,e[4]=W,e[5]=N):N=e[5];const E=N;let B;e[6]!==l||e[7]!==i||e[8]!==a.word||e[9]!==r?(B=R=>{C(!1);const j=R.currentTarget.value;j!==a.word&&l(_=>{_.lyricLines[i].words[r].word=j})},e[6]=l,e[7]=i,e[8]=a.word,e[9]=r,e[10]=B):B=e[10];const I=B;let G;return e[11]!==E||e[12]!==f||e[13]!==w||e[14]!==M||e[15]!==o||e[16]!==i||e[17]!==I||e[18]!==x||e[19]!==y||e[20]!==a.id||e[21]!==a.word||e[22]!==t||e[23]!==r?(G=w?s.jsx(ht,{autoFocus:!0,defaultValue:a.word,onBlur:I,onKeyDown:R=>{R.key==="Enter"&&I(R)}}):s.jsxs(gt,{onOpenChange:R=>{R&&(M||(y(j=>{j.clear(),j.add(a.id)}),x(j=>{j.clear(),j.add(o.id)})))},children:[s.jsx(pt,{children:s.jsx(Un,{wordAtom:t,wordIndex:r,lineIndex:i,className:E,line:o,onDoubleClick:()=>{C(!0)},children:f})}),s.jsxs(xt,{children:[s.jsx(Ht,{wordAtom:t,wordIndex:r,lineIndex:i}),s.jsx(Ct,{lineIndex:i})]})]}),e[11]=E,e[12]=f,e[13]=w,e[14]=M,e[15]=o,e[16]=i,e[17]=I,e[18]=x,e[19]=y,e[20]=a.id,e[21]=a.word,e[22]=t,e[23]=r,e[24]=G):G=e[24],G},Ds=n=>{const e=Ee.c(38),{wordAtom:t,line:r}=n,o=F(t);let i;e[0]!==t?(i=se(O=>O(pe).has(O(t).id)),e[0]=t,e[1]=i):i=e[1];const a=i;let l;e[2]!==t?(l=se(O=>{const z=O(pn),$=O(t);return z>=$.startTime&&z<$.endTime}),e[2]=t,e[3]=l):l=e[3];const p=F(l),g=F(a),M=fe(pe),y=fe(Se),w=F(xn),C=F(yn),b=F(jr),m=F(Rr),f=F(Nr),h=F(Ge),v=Mt(o.word),S=Kn(o.word,v,o.romanWord,f),W=d.useRef(null),N=d.useRef(null);let E;e[4]!==w?(E=()=>{if(!w)return;const O=W.current?.animate([{backgroundColor:"var(--green-a8)"},{backgroundColor:"var(--green-a4)"}],{duration:500});return()=>{O?.cancel()}},e[4]=w,e[5]=E):E=e[5];let B;e[6]!==w||e[7]!==o.startTime?(B=[o.startTime,w],e[6]=w,e[7]=o.startTime,e[8]=B):B=e[8],d.useEffect(E,B);let I;e[9]!==w?(I=()=>{if(!w)return;const O=N.current?.animate([{backgroundColor:"var(--red-a8)"},{backgroundColor:"var(--red-a4)"}],{duration:500});return()=>{O?.cancel()}},e[9]=w,e[10]=I):I=e[10];let G;e[11]!==w||e[12]!==o.endTime?(G=[o.endTime,w],e[11]=w,e[12]=o.endTime,e[13]=G):G=e[13],d.useEffect(I,G);const R=o.startTime>o.endTime,j=g&&A.selected,_=v&&A.blank,D=p&&m&&A.active,u=R&&(h===J.Edit||h===J.Sync&&C&&b)&&A.error;let T;e[14]!==u||e[15]!==j||e[16]!==_||e[17]!==D?(T=Q(A.lyricWord,A.sync,j,_,D,u),e[14]=u,e[15]=j,e[16]=_,e[17]=D,e[18]=T):T=e[18];const k=T;let Z;e[19]!==r||e[20]!==y||e[21]!==M||e[22]!==o.id?(Z=O=>{O.stopPropagation(),O.preventDefault(),y(z=>{z.clear(),z.add(r.id)}),M(z=>{z.clear(),z.add(o.id)})},e[19]=r,e[20]=y,e[21]=M,e[22]=o.id,e[23]=Z):Z=e[23];let q;e[24]!==C||e[25]!==o.startTime?(q=C&&s.jsx("div",{className:Q(A.startTime),ref:W,children:Ke(o.startTime)}),e[24]=C,e[25]=o.startTime,e[26]=q):q=e[26];let L;e[27]!==S?(L=s.jsx("div",{className:A.displayWord,children:S}),e[27]=S,e[28]=L):L=e[28];let V;e[29]!==C||e[30]!==o.endTime?(V=C&&s.jsx("div",{className:Q(A.endTime),ref:N,children:Ke(o.endTime)}),e[29]=C,e[30]=o.endTime,e[31]=V):V=e[31];let c;return e[32]!==k||e[33]!==Z||e[34]!==q||e[35]!==L||e[36]!==V?(c=s.jsxs("div",{className:k,onClick:Z,children:[q,L,V]}),e[32]=k,e[33]=Z,e[34]=q,e[35]=L,e[36]=V,e[37]=c):c=e[37],c},Kn=(n,e,t,r)=>{const o=Ee.c(5),{t:i}=Xe();let a;e:{if(r&&t&&t.trim()!==""){a=t;break e}if(n===""){let l;o[0]!==i?(l=i("lyricWordView.empty","空白"),o[0]=i,o[1]=l):l=o[1],a=l;break e}if(e){let l;o[2]!==i||o[3]!==n.length?(l=i("lyricWordView.spaceCount","空格 x{count}",{count:n.length}),o[2]=i,o[3]=n.length,o[4]=l):l=o[4],a=l;break e}a=n}return a},ks=d.memo(n=>{const e=Ee.c(25),{wordAtom:t,wordIndex:r,line:o,lineIndex:i}=n,a=F(t),l=F(Ge),x=F(_r),p=Mt(a.word);let g;e[0]!==x||e[1]!==o||e[2]!==i||e[3]!==l||e[4]!==t||e[5]!==r?(g=l===J.Edit&&x===en.Simple&&s.jsx(Fs,{wordAtom:t,line:o,lineIndex:i,wordIndex:r}),e[0]=x,e[1]=o,e[2]=i,e[3]=l,e[4]=t,e[5]=r,e[6]=g):g=e[6];let M;e[7]!==x||e[8]!==o||e[9]!==i||e[10]!==l||e[11]!==t||e[12]!==r?(M=l===J.Edit&&x===en.Advance&&s.jsx(Bs,{wordAtom:t,line:o,lineIndex:i,wordIndex:r}),e[7]=x,e[8]=o,e[9]=i,e[10]=l,e[11]=t,e[12]=r,e[13]=M):M=e[13];let y;e[14]!==p||e[15]!==o||e[16]!==i||e[17]!==l||e[18]!==t||e[19]!==r?(y=l===J.Sync&&!p&&s.jsx(Ds,{wordAtom:t,line:o,lineIndex:i,wordIndex:r}),e[14]=p,e[15]=o,e[16]=i,e[17]=l,e[18]=t,e[19]=r,e[20]=y):y=e[20];let w;return e[21]!==g||e[22]!==M||e[23]!==y?(w=s.jsxs("div",{children:[g,M,y]}),e[21]=g,e[22]=M,e[23]=y,e[24]=w):w=e[24],w});function zs(n){return{...n,id:qe().id}}function Gs(n){n.currentTarget.classList.remove(A.dropLeft),n.currentTarget.classList.remove(A.dropRight)}const Vs="_romanWordView_14zqx_1",Os="_placeholder_14zqx_11",Zs="_warning_14zqx_25",ct={romanWordView:Vs,placeholder:Os,warning:Zs};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};const $s=n=>{const e=Ee.c(37),{wordAtom:t,wordIndex:r,editingIndexAtom:o,suggestedRoman:i}=n,a=F(t),[l,x]=Ir(o),p=fe(we),[g,M]=d.useState(a.romanWord),y=d.useRef(null),w=l===r;let C;e[0]!==p||e[1]!==x||e[2]!==a.id||e[3]!==a.romanWord?(C=j=>{j!==a.romanWord&&p(_=>{for(const D of _.lyricLines){const u=D.words.find(T=>T.id===a.id);if(u){u.romanWord=j;break}}}),x(null)},e[0]=p,e[1]=x,e[2]=a.id,e[3]=a.romanWord,e[4]=C):C=e[4];const b=C;let m,f;e[5]!==w||e[6]!==i||e[7]!==a.romanWord?(m=()=>{w&&M(a.romanWord||i||"")},f=[w,a.romanWord,i],e[5]=w,e[6]=i,e[7]=a.romanWord,e[8]=m,e[9]=f):(m=e[8],f=e[9]),d.useEffect(m,f);let h,v;e[10]!==w?(h=()=>{w&&(y.current?.focus(),y.current?.select())},v=[w],e[10]=w,e[11]=h,e[12]=v):(h=e[11],v=e[12]),d.useEffect(h,v);let S;e[13]!==b||e[14]!==x||e[15]!==r?(S=j=>{const _=j.currentTarget.value;e:switch(j.key){case"Enter":case"Tab":{j.preventDefault(),b(_),x(r+1);break e}case"Escape":{j.preventDefault(),x(null);break e}case"Backspace":{_===""&&(j.preventDefault(),b(""),x(r-1));break e}}},e[13]=b,e[14]=x,e[15]=r,e[16]=S):S=e[16];const W=S;if(w){const j=a.romanWarning&&ct.warning;let _;e[17]!==j?(_=Q(ct.romanWordView,j),e[17]=j,e[18]=_):_=e[18];let D;e[19]===Symbol.for("react.memo_cache_sentinel")?(D=k=>M(k.currentTarget.value),e[19]=D):D=e[19];let u;e[20]!==b?(u=k=>b(k.currentTarget.value),e[20]=b,e[21]=u):u=e[21];let T;return e[22]!==W||e[23]!==g||e[24]!==u||e[25]!==_?(T=s.jsx(ht,{ref:y,size:"1",className:_,value:g,onChange:D,onBlur:u,onKeyDown:W}),e[22]=W,e[23]=g,e[24]=u,e[25]=_,e[26]=T):T=e[26],T}const N=!a.romanWord&&ct.placeholder,E=a.romanWarning&&ct.warning;let B;e[27]!==N||e[28]!==E?(B=Q(ct.romanWordView,N,E),e[27]=N,e[28]=E,e[29]=B):B=e[29];let I;e[30]!==x||e[31]!==r?(I=j=>{j.stopPropagation(),x(r)},e[30]=x,e[31]=r,e[32]=I):I=e[32];const G=a.romanWord||"";let R;return e[33]!==I||e[34]!==G||e[35]!==B?(R=s.jsx(dt,{size:"1",variant:"soft",color:"gray",className:B,onClick:I,children:G}),e[33]=I,e[34]=G,e[35]=B,e[36]=R):R=e[36],R};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};const He=globalThis.jotaiAtomCache.get("/vercel/path0/src/modules/lyric-editor/components/lyric-line-view.tsx/isDraggingAtom",se(!1));He.debugLabel="isDraggingAtom";He.debugLabel="isDraggingAtom";const qt=globalThis.jotaiAtomCache.get("/vercel/path0/src/modules/lyric-editor/components/lyric-line-view.tsx/lineDisplayNumbersAtom",se(n=>{const{lyricLines:e}=n(we),t=[];let r=0;for(const[o,i]of e.entries())(!o||!i.isBG)&&r++,t.push(r);return t}));qt.debugLabel="lineDisplayNumbersAtom";qt.debugLabel="lineDisplayNumbersAtom";const Hs=n=>{const e=Ee.c(10),{lineAtom:t,wordsContainer:r,editingRomanWordIndex:o}=n;let i;e[0]!==t?(i=se(y=>{const w=y(t),C=y(pe);if(C.size===0)return Number.NaN;let b=Number.NaN,m=0;for(const f of w.words){if(C.has(f.id)){b=m;break}m++}return b}),e[0]=t,e[1]=i):i=e[1];const l=F(i);let x,p;e[2]!==o||e[3]!==l||e[4]!==r?(x=()=>{const y=Number.isNaN(l)?o:l;if(y===null||Number.isNaN(y)||!r)return;const w=r.children[y];w&&r.scrollTo({left:w.offsetLeft-r.clientWidth/2,behavior:"auto"})},p=[l,o,r],e[2]=o,e[3]=l,e[4]=r,e[5]=x,e[6]=p):(x=e[5],p=e[6]),d.useEffect(x,p);let g,M;return e[7]!==r?(g=()=>{if(!r)return;const y=w=>{const C=w.target;if(!C)return;const b=C.closest("[data-word-index]");!b||!r.contains(b)||r.scrollTo({left:b.offsetLeft-r.clientWidth/2,behavior:"auto"})};return r.addEventListener("focusin",y),()=>{r.removeEventListener("focusin",y)}},M=[r],e[7]=r,e[8]=g,e[9]=M):(g=e[8],M=e[9]),d.useEffect(g,M),null},an=d.memo(n=>{const e=Ee.c(26),{lineAtom:t,lineIndex:r,type:o}=n,i=fe(we),a=F(t),[l,x]=d.useState(!1),[p,g]=d.useState(""),{t:M}=Xe();let y;e[0]!==i||e[1]!==a||e[2]!==r||e[3]!==o?(y=E=>{x(!1);const B=E.currentTarget.value;B!==a[o]&&i(I=>{I.lyricLines[r][o]=B})},e[0]=i,e[1]=a,e[2]=r,e[3]=o,e[4]=y):y=e[4];const w=y;let C,b;e[5]!==l||e[6]!==a||e[7]!==o?(C=()=>{l&&g(a[o]||"")},b=[l,a,o],e[5]=l,e[6]=a,e[7]=o,e[8]=C,e[9]=b):(C=e[8],b=e[9]),d.useEffect(C,b);let m;e:{if(p.length>0){m=`${Math.min(Math.max(p.length,2),60)}ch`;break e}m="12ch"}const f=m;let h;e[10]!==M||e[11]!==o?(h=o==="translatedLyric"?M("lyricLineView.translatedLabel","翻译："):M("lyricLineView.romanLabel","音译："),e[10]=M,e[11]=o,e[12]=h):h=e[12];const v=h;let S;e[13]!==v?(S=s.jsx(ut,{size:"2",children:v}),e[13]=v,e[14]=S):S=e[14];let W;e[15]!==l||e[16]!==p||e[17]!==f||e[18]!==a||e[19]!==w||e[20]!==M||e[21]!==o?(W=l?s.jsx(ht,{autoFocus:!0,size:"1",value:p,style:{width:f},onChange:E=>g(E.currentTarget.value),onBlur:w,onKeyDown:E=>{E.key==="Enter"&&w(E)}}):s.jsx(dt,{size:"2",color:"gray",variant:"ghost",onClick:E=>{E.stopPropagation(),x(!0)},children:a[o]||s.jsx(ut,{color:"gray",children:M("lyricLineView.empty","无")})}),e[15]=l,e[16]=p,e[17]=f,e[18]=a,e[19]=w,e[20]=M,e[21]=o,e[22]=W):W=e[22];let N;return e[23]!==S||e[24]!==W?(N=s.jsxs(Fe,{align:"baseline",children:[S,W]}),e[23]=S,e[24]=W,e[25]=N):N=e[25],N}),qs=d.memo(({lineAtom:n,lineIndex:e})=>{const{t}=Xe(),r=F(n),o=fe(Se),i=d.useMemo(()=>{const u=se(T=>T(Se).has(r.id));return u.debugLabel="a",u.debugLabel="a",u},[r.id]),a=d.useMemo(()=>wn(se(u=>u(n).words)),[n]),l=F(a),x=F(i),p=fe(pe),g=fe(we),M=F(xn),y=F(yn),w=F(Ge),C=mt(),b=d.useRef(null),m=d.useRef(!1),f=d.useMemo(()=>se(u=>u(qt)[e]),[e]),h=F(f),v=d.useMemo(()=>{if(r.startTime>r.endTime)return!0;for(const u of r.words)if(u.startTime>u.endTime)return!0;return!1},[r.startTime,r.endTime,r.words]),S=F(Wr),W=F(Pr),N=F(Br),E=d.useMemo(()=>se(null),[]),B=F(E),I=F(Fr),G=d.useRef(null),R=d.useRef(null),[j,_]=d.useState(!1);d.useEffect(()=>{if(!M)return;const u=G.current?.animate([{backgroundColor:"var(--green-a8)"},{backgroundColor:"var(--green-a4)"}],{duration:500});return()=>{u?.cancel()}},[r.startTime,M]),d.useLayoutEffect(()=>{w!==J.Edit&&_(!1)},[w]),d.useEffect(()=>{if(!M)return;const u=R.current?.animate([{backgroundColor:"var(--red-a8)"},{backgroundColor:"var(--red-a4)"}],{duration:500});return()=>{u?.cancel()}},[r.endTime,M]);const D=d.useMemo(()=>I?kr(r.words,r.romanLyric||""):[],[r.romanLyric,r.words,I]);return s.jsxs(s.Fragment,{children:[s.jsx(Hs,{lineAtom:n,wordsContainer:b.current,editingRomanWordIndex:B}),j&&s.jsx(dt,{mx:"2",my:"1",variant:"soft",size:"1",style:{width:"calc(100% - var(--space-4))"},onClick:()=>{g(u=>{u.lyricLines.splice(e,0,ke())}),_(!1)},children:t("lyricLineView.insertLine","在此插入新行")}),s.jsxs(gt,{onOpenChange:u=>{u&&(C.get(Se).has(r.id)||C.set(Se,new Set([r.id])))},children:[s.jsx(pt,{disabled:w!==J.Edit,children:s.jsx(Fe,{mx:"2",my:"1",direction:"row",className:Q(A.lyricLine,x&&A.selected,w===J.Sync&&A.sync,w===J.Edit&&A.edit,r.ignoreSync&&A.ignoreSync,v&&w===J.Edit&&A.error),align:"center",gapX:"4",draggable:w===J.Edit,onPointerDown:u=>{m.current=u.target?.tagName==="INPUT"},onPointerUp:()=>{m.current=!1},onDragStart:u=>{if(m.current){m.current=!1,u.preventDefault(),u.stopPropagation();return}u.dataTransfer.dropEffect="move",C.set(He,!0),C.set(Ze,r.id)},onDragEnd:()=>{C.set(He,!1)},onDragOver:u=>{if(!C.get(He)||C.get(Ze)===r.id||x)return;u.preventDefault(),u.dataTransfer.dropEffect="move";const T=u.currentTarget.getBoundingClientRect();u.clientY-T.top<T.height/2?(u.currentTarget.classList.add(A.dropTop),u.currentTarget.classList.remove(A.dropBottom)):(u.currentTarget.classList.remove(A.dropTop),u.currentTarget.classList.add(A.dropBottom))},onDrop:u=>{if(u.currentTarget.classList.remove(A.dropTop),u.currentTarget.classList.remove(A.dropBottom),!C.get(He))return;const T=u.currentTarget.getBoundingClientRect(),k=u.clientY-T.top,Z=C.get(Se),q=Z.has(C.get(Ze))?Z:new Set([C.get(Ze)]),L=k>=T.height/2?1:0;g(V=>{const c=V.lyricLines.filter($=>!q.has($.id)),O=V.lyricLines.filter($=>q.has($.id)),z=c.findIndex($=>$.id===r.id);z<0||(V.lyricLines=[...c.slice(0,z+L),...O,...c.slice(z+L)])})},onDragLeave:u=>{u.currentTarget.classList.remove(A.dropTop),u.currentTarget.classList.remove(A.dropBottom)},onClick:u=>{u.stopPropagation(),u.preventDefault(),u.ctrlKey?o(T=>{T.has(r.id)?T.delete(r.id):T.add(r.id)}):u.shiftKey?o(T=>{if(T.size>0){let k=Number.NaN,Z=Number.NaN;const q=C.get(we).lyricLines;q.forEach((L,V)=>{T.has(L.id)&&(Number.isNaN(k)&&(k=V),Number.isNaN(Z)&&(Z=V),k=Math.min(k,V,e),Z=Math.max(Z,V,e))});for(let L=k;L<=Z;L++)T.add(q[L].id)}else T.add(r.id)}):(o(T=>{(!T.has(r.id)||T.size!==1)&&(T.clear(),T.add(r.id))}),p(T=>{T.size!==0&&T.clear()}))},asChild:!0,children:s.jsxs("div",{children:[s.jsxs(Fe,{direction:"column",align:"center",justify:"center",ml:"3",children:[s.jsx(ut,{className:Q(A.lineNumber,r.ignoreSync&&A.ignored),align:"center",color:"gray",children:h}),r.isBG&&s.jsx(Mo,{color:"#4466FF"}),r.isDuet&&s.jsx(Eo,{color:"#44AA33"})]}),s.jsxs("div",{className:Q(A.lyricLineContainer,w===J.Edit&&A.edit,w===J.Sync&&A.sync),children:[s.jsxs("div",{className:Q(A.lyricWordsContainer,w===J.Edit&&A.edit,w===J.Sync&&A.sync,!y&&A.hideTimestamps),ref:b,children:[l.map((u,T)=>{const k=C.get(u);return s.jsxs(d.Fragment,{children:[j&&s.jsx(Ue,{size:"1",variant:"soft",onClick:Z=>{Z.preventDefault(),Z.stopPropagation(),g(q=>{q.lyricLines[e].words.splice(T,0,qe())})},children:s.jsx(Rt,{})}),s.jsxs(Fe,{direction:"column",align:"stretch",gap:"3","data-word-index":T,className:A.wordGroup,children:[s.jsx(ks,{wordAtom:u,wordIndex:T,line:r,lineIndex:e}),w===J.Edit&&S&&s.jsx($s,{wordAtom:u,wordIndex:T,editingIndexAtom:E,suggestedRoman:D[T]})]})]},`word-${k.id}`)}),j&&s.jsx(Ue,{size:"1",variant:"soft",onClick:u=>{u.preventDefault(),u.stopPropagation(),g(T=>{T.lyricLines[e].words.push(qe())})},children:s.jsx(Rt,{})}),w===J.Edit&&s.jsx(ht,{placeholder:t("lyricLineView.insertWord","插入单词…"),className:Q(A.insertWordField,l.length===0&&A.empty),style:{alignSelf:"center"},onKeyDown:u=>{u.key==="Enter"&&(u.preventDefault(),u.stopPropagation(),g(T=>{T.lyricLines[e].words.push({...qe(),word:u.currentTarget.value})}),u.currentTarget.value="")}})]}),w===J.Edit&&s.jsxs(s.Fragment,{children:[W&&s.jsx(an,{lineAtom:n,lineIndex:e,type:"translatedLyric"}),N&&s.jsx(an,{lineAtom:n,lineIndex:e,type:"romanLyric"})]})]}),w===J.Edit&&s.jsx(Fe,{p:"3",children:s.jsx(Ue,{size:"1",variant:j?"solid":"soft",onClick:u=>{u.preventDefault(),u.stopPropagation(),_(T=>!T)},children:s.jsx(Rt,{})})}),w===J.Sync&&y&&s.jsxs(Fe,{pr:"3",gap:"1",direction:"column",align:"stretch",children:[s.jsx("div",{className:A.startTime,ref:G,children:Ke(r.startTime)}),s.jsx("div",{className:A.endTime,ref:R,children:Ke(r.endTime)})]})]})})}),s.jsx(xt,{children:s.jsx(Ct,{lineIndex:e})})]}),j&&s.jsx(dt,{mx:"2",my:"1",variant:"soft",size:"1",style:{width:"calc(100% - var(--space-4))"},onClick:()=>{g(u=>{u.lyricLines.splice(e+1,0,ke())}),_(!1)},children:t("lyricLineView.insertLine","在此插入新行")})]})});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(n,e){return this.cache.has(n)?this.cache.get(n):(this.cache.set(n,e),e)}};const Ut=globalThis.jotaiAtomCache.get("/vercel/path0/src/modules/lyric-editor/components/index.tsx/lyricLinesOnlyAtom",wn(ss(we,n=>n.prop("lyricLines"))));Ut.debugLabel="lyricLinesOnlyAtom";Ut.debugLabel="lyricLinesOnlyAtom";const Us=(n,e)=>{const t=o=>{let i=-1;for(let a=0;a<n.length;a++){const l=n[a];if(!(o&&!o(l))&&!(l.endTime<=l.startTime)){if(e<l.startTime)return i!==-1?i:a;if(e>=l.startTime&&e<=l.endTime)return a;i=a}}return i},r=t(o=>!o.isBG);return r!==-1?r:t()},Js=d.forwardRef((n,e)=>{const t=Ee.c(40),r=F(Ut),o=F(we).lyricLines,i=F(pn),a=d.useRef(null),l=d.useRef(null),x=F(Ge),{t:p}=Xe();let g;t[0]!==r||t[1]!==x?(g=se(_=>{if(x!==J.Sync)return;const D=_(Se);let u=Number.NaN,T=0;for(const k of r){const Z=_(k);if(D.has(Z.id)){u=T;break}T++}if(!Number.isNaN(u))return u}),t[0]=r,t[1]=x,t[2]=g):g=t[2];const y=F(g);let w;t[3]===Symbol.for("react.memo_cache_sentinel")?(w=_=>{const D=l.current;if(!D)return;const u=D.parentElement;u&&a.current?.scrollToIndex({index:_,offset:u.clientHeight/-2+50})},t[3]=w):w=t[3];const C=w;let b,m;t[4]!==y?(b=()=>{y!==void 0&&C(y)},m=[y,C],t[4]=y,t[5]=b,t[6]=m):(b=t[5],m=t[6]),d.useEffect(b,m);let f;t[7]!==i||t[8]!==o?(f=()=>{const _=Us(o,i);_!==-1&&C(_)},t[7]=i,t[8]=o,t[9]=f):f=t[9];const h=f;let v,S;if(t[10]===Symbol.for("react.memo_cache_sentinel")?(v=()=>l.current,S=[],t[10]=v,t[11]=S):(v=t[10],S=t[11]),d.useImperativeHandle(e,v,S),r.length===0){let _;t[12]!==p?(_=p("app.empty.title","没有歌词行"),t[12]=p,t[13]=_):_=t[13];let D;t[14]!==_?(D=s.jsx(ut,{color:"gray",children:_}),t[14]=_,t[15]=D):D=t[15];let u;t[16]!==p?(u=p("app.empty.description","在顶部面板中添加新歌词行或从菜单栏打开 / 导入已有歌词"),t[16]=p,t[17]=u):u=t[17];let T;t[18]!==u?(T=s.jsx(ut,{color:"gray",children:u}),t[18]=u,t[19]=T):T=t[19];let k;return t[20]!==e||t[21]!==T||t[22]!==D?(k=s.jsxs(Fe,{flexGrow:"1",gap:"2",align:"center",justify:"center",direction:"column",height:"100%",ref:e,children:[D,T]}),t[20]=e,t[21]=T,t[22]=D,t[23]=k):k=t[23],k}const W=x===J.Sync?"20vh 0":void 0;let N;t[24]!==W?(N={padding:W,maxHeight:"100%",overflowY:"auto"},t[24]=W,t[25]=N):N=t[25];let E;t[26]!==r?(E=s.jsx(cs.ViewportList,{overscan:10,items:r,ref:a,viewportRef:l,children:Ks}),t[26]=r,t[27]=E):E=t[27];let B;t[28]!==N||t[29]!==E?(B=s.jsx(nn,{flexGrow:"1",style:N,ref:l,children:E}),t[28]=N,t[29]=E,t[30]=B):B=t[30];let I;t[31]!==p?(I=p("lyricEditor.locate","定位"),t[31]=p,t[32]=I):I=t[32];let G;t[33]===Symbol.for("react.memo_cache_sentinel")?(G=s.jsx(zr,{}),t[33]=G):G=t[33];let R;t[34]!==h||t[35]!==I?(R=s.jsx(dt,{className:A.locateButton,variant:"soft",onClick:h,title:I,children:G}),t[34]=h,t[35]=I,t[36]=R):R=t[36];let j;return t[37]!==B||t[38]!==R?(j=s.jsxs(nn,{flexGrow:"1",className:A.lyricLinesWrapper,children:[B,R]}),t[37]=B,t[38]=R,t[39]=j):j=t[39],j});function Ks(n,e){return s.jsx(qs,{lineAtom:n,lineIndex:e},`${n}`)}export{Js as LyricLinesView,Js as default};
//# sourceMappingURL=index-DhtNP3DS.js.map
